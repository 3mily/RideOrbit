 <h1>Place</h1>
 <%= form_for @place, url: {action: 'create'} do |f| %>

<div>
  <%= f.label "name", "Name" %> <br>
  <%= f.text_field :name %>
</div>
<div>
  <%= f.label "cross_street", "Cross Streets" %><br>
  <%= text_field_tag :street1 %> and <%= text_field_tag :street2 %>
  <% f.hidden_field :cross_street_point %>
</div>

<%= f.submit "Submit" %>
<% end %>


<% if @places %>
  <% @places.each do |place| %>
    <div>
    <%= place.name %> - <%= place.cross_street %>
    </div>
  <% end %>
  <%= link_to "Make a Commute", newcommute_path %>
<% end %>

<script type="text/javascript">
function initialize(search) {
  var input = document.getElementById(search);
  if (input) {
    var autocomplete = new google.maps.places.Autocomplete(input);
    google.maps.event.addListener(autocomplete, 'place_changed', function () {
        var place = autocomplete.getPlace();
        console.log(place);
        console.log("name: " + place.name);
        console.log("lat: " + place.geometry.location.lat());
        console.log("lng: " + place.geometry.location.lng());
    });
  };
}
google.maps.event.addDomListener(window, 'load', function() {
  initialize('street1');
  initialize('street2');
});

//right now, it doesn't throw an error even if the input fields are empty.
$("#new_place").on("submit", function(e){
  e.preventDefault();
  var query = $("#street1").val() + " and " + $("#street2").val();
  console.log('testing query(xst): ' + query);
  var xstData;
  var name = $("#place_name").val();

  $.ajax({
    url: "http://maps.googleapis.com/maps/api/geocode/json?address="+query+"&sensor=false",
    type: "POST",
    error: function(xhr, status, thrownError){
      console.log("oh noes!", thrownError);
    },
    success: function(data){ //cross-street data from gmaps api
      console.log("data: ", data);
      var lat = data.results[0].geometry.location.lat;
      var lng = data.results[0].geometry.location.lng;
      xstData = data;
      var params = {
        "name": name,
      }

      $.ajax({
        url: "/places",
        type: "POST",
        data: params,
        error: function(xhr, status, thrownError){
          console.log('oh noesssss....', thrownError);
        },
        success: function(response) {
          console.log('success!');
        }
      });

    }
  });
});
</script>



